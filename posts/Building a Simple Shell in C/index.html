<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="280CharsArentEnough - A blog about tech, coding, and more"/><title>280CharsArentEnough</title><meta name="next-head-count" content="4"/><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/280CharsArentEnough/_next/static/css/6dcbcdbe6caa9ef7.css" as="style" crossorigin=""/><link rel="stylesheet" href="/280CharsArentEnough/_next/static/css/6dcbcdbe6caa9ef7.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/280CharsArentEnough/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/280CharsArentEnough/_next/static/chunks/webpack-8672eacd894b3a6b.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/chunks/framework-2c0fa632eea9ca9a.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/chunks/main-3d28be63e8e7ba92.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/chunks/pages/_app-6c0ff85e79cb2965.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/chunks/996-2621915a071d1e63.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/chunks/pages/posts/%5Bslug%5D-98f8939dd397a2a9.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/NyHoP_d_kbc-0VeRRnbDN/_buildManifest.js" defer="" crossorigin=""></script><script src="/280CharsArentEnough/_next/static/NyHoP_d_kbc-0VeRRnbDN/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuLyfMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuI6fMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuGKYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcCO3FwrK3iLTeHuS_nVMrMxCp50SjIw2boKoduKmMEVuFuYMZs.woff) format('woff')}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2JL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa0ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2ZL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa2pL7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa25L7W0Q5n-wU.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inter';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v18/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="container mt-4"><header class="text-center mb-5"><a class="text-decoration-none" href="/280CharsArentEnough/"><h1 class="blog-title">280CharsArentEnough</h1></a><p class="subtitle">Thoughts that don&#x27;t fit in your average tweet</p></header><main><article class="blog-post"><header class="blog-post-header"><h1>Building a Shell in C</h1><div class="text-muted mb-4">October 28, 2024</div><div class="mb-4 timeline-categories"><span><a class="timeline-category" href="/280CharsArentEnough/?category=Programming">Programming</a><span style="color:#666;margin:0 4px">•</span></span><span><a class="timeline-category" href="/280CharsArentEnough/?category=C">C</a><span style="color:#666;margin:0 4px">•</span></span><span><a class="timeline-category" href="/280CharsArentEnough/?category=Operating%20Systems">Operating Systems</a></span></div></header><div class="blog-post-content"><h1>Building a shell with pipes in C</h1>
<p>Command-line shells are an essential part of operating systems, allowing users to interact with the system via commands. While modern operating systems have powerful, feature-rich shells, understanding how they work at a low level provides crucial insight into process management, input/output operations, and more. In this post, we’ll take a closer look at building a simple shell in C, particularly focusing on three key phases: <strong>Read</strong>, <strong>Parse</strong>, and <strong>Execute</strong>.</p>
<div class="video-container">
  <iframe
    width="100%"
    height="500"
    src="https://www.youtube.com/embed/2J7g3KcZJ3I"
    title="Building a Simple Shell in C"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen>
  </iframe>
</div>
<h3>1. The Shell Process Lifecycle</h3>
<p>The shell can be broken down into three distinct phases:</p>
<ul>
<li>
<p><strong>Read Phase</strong>: The shell reads the user’s command.</p>
</li>
<li>
<p><strong>Parse Phase</strong>: The shell breaks the command into individual tokens (like command and arguments) and prepares for execution.</p>
</li>
<li>
<p><strong>Execute Phase</strong>: The shell forks a new process to execute the command.</p>
</li>
</ul>
<p>Let’s explore each phase in more detail.</p>
<hr>
<h3>2. <strong>Read Phase</strong></h3>
<p>In the <strong>Read Phase</strong>, the shell waits for user input. This input could be a simple command like <code>ls</code> or something more complex, involving pipes (<code>|</code>) and redirection (<code>&gt;</code>, <code>&lt;</code>). The input is typically read as a single string, which the shell will process further.</p>
<p>In C, this can be achieved using functions like <code>fgets()</code> or <code>read()</code> to capture input from the user.</p>
<h4>Example:</h4>
<pre class="hljs"><code>
<span class="hljs-type">char</span> input[<span class="hljs-number">1024</span>];

<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;shell&gt; &quot;</span>);

fgets(input, <span class="hljs-keyword">sizeof</span>(input), <span class="hljs-built_in">stdin</span>);

</code></pre>
<p>This code snippet captures user input of up to 1024 characters. Once the input is read, the shell proceeds to the <strong>Parse Phase</strong>.</p>
<hr>
<h3>3. <strong>Parse Phase</strong></h3>
<p>The <strong>Parse Phase</strong> involves breaking down the user’s input into smaller components, known as <strong>tokens</strong>. These tokens are typically the command (like <code>ls</code>) and its arguments (like <code>-l</code>, <code>| grep .c</code>).</p>
<p>In C, functions like <code>strtok()</code> are useful for breaking the input string into tokens based on delimiters (like spaces or pipe symbols).</p>
<h4>Example:</h4>
<pre class="hljs"><code>
<span class="hljs-type">char</span> *token;

token = strtok(input, <span class="hljs-string">&quot; \n&quot;</span>);

<span class="hljs-keyword">while</span> (token != <span class="hljs-literal">NULL</span>) {

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, token);  <span class="hljs-comment">// Process each token</span>

    token = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot; \n&quot;</span>);

}

</code></pre>
<p>This will break the user’s input into individual tokens. For example, if the user types <code>ls -l | grep .c</code>, the tokens will be <code>ls</code>, <code>-l</code>, <code>|</code>, and <code>grep .c</code>.</p>
<p>The shell needs to handle each of these tokens appropriately, determining what the user wants to achieve (e.g., if there’s a pipe, we need to split the command into two processes).</p>
<hr>
<h3>4. <strong>Execute Phase</strong></h3>
<p>Finally, the <strong>Execute Phase</strong> is where the shell runs the command. In most cases, this involves creating a new child process using <code>fork()</code>, and then using <code>execvp()</code> or similar system calls to replace the child process’s memory with the new command’s memory.</p>
<p>For commands involving pipes or redirection, this phase becomes slightly more complex, as the shell needs to manage file descriptors and direct output from one process to another.</p>
<h4>Example:</h4>
<pre class="hljs"><code>
<span class="hljs-type">pid_t</span> pid = fork();

<span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) {

    <span class="hljs-comment">// Child process</span>

    execvp(command[<span class="hljs-number">0</span>], command);

    perror(<span class="hljs-string">&quot;execvp&quot;</span>);

    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);

} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>) {

    <span class="hljs-comment">// Parent process</span>

    wait(<span class="hljs-literal">NULL</span>);

} <span class="hljs-keyword">else</span> {

    perror(<span class="hljs-string">&quot;fork&quot;</span>);

    <span class="hljs-built_in">exit</span>(EXIT_FAILURE);

}

</code></pre>
<p>This simple fork/exec pattern allows the shell to run commands. The parent process waits for the child to complete using <code>wait()</code>, ensuring that commands are executed sequentially unless the user requests background execution.</p>
<hr>
<h3>5. <strong>Advanced Features</strong></h3>
<p>Building a fully functional shell also requires adding advanced features like:</p>
<ul>
<li>
<p><strong>Piping</strong>: Sending the output of one command as input to another (e.g., <code>ls | grep .c</code>).</p>
</li>
<li>
<p><strong>Redirection</strong>: Redirecting output to a file or input from a file (e.g., <code>ls &gt; output.txt</code>).</p>
</li>
<li>
<p><strong>Signal Handling</strong>: Handling interrupts (e.g., <code>Ctrl+C</code>) to terminate running processes or commands.</p>
</li>
</ul>
<p>While these features add complexity, they are also what make a shell useful. Understanding the basics of process control and inter-process communication (pipes) will help you implement these features.</p>
<hr>
<h3>Conclusion</h3>
<p>Building a shell from scratch is an excellent way to learn about process management, system calls, and low-level programming in C. By breaking the problem down into the <strong>Read</strong>, <strong>Parse</strong>, and <strong>Execute</strong> phases, you can focus on each aspect individually and build up to more complex features like piping and redirection.</p>
<p>Once you understand how these phases interact, you can experiment with adding more functionality and customization to your shell. And who knows? You might end up building a command-line interface that fits your workflow better than existing ones.</p>
<hr>
<p>GitHub: <a href="https://github.com/Atharva2099">@FullMLAlchemist</a>
Twitter: <a href="https://x.com/attharave">@Attharave</a></p>
</div><footer class="mt-5 pt-4 border-top"><a class="back-link" href="/280CharsArentEnough/">← Back to home</a></footer></article></main></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"slug":"Building a Simple Shell in C","htmlContent":"\u003ch1\u003eBuilding a shell with pipes in C\u003c/h1\u003e\n\u003cp\u003eCommand-line shells are an essential part of operating systems, allowing users to interact with the system via commands. While modern operating systems have powerful, feature-rich shells, understanding how they work at a low level provides crucial insight into process management, input/output operations, and more. In this post, we’ll take a closer look at building a simple shell in C, particularly focusing on three key phases: \u003cstrong\u003eRead\u003c/strong\u003e, \u003cstrong\u003eParse\u003c/strong\u003e, and \u003cstrong\u003eExecute\u003c/strong\u003e.\u003c/p\u003e\n\u003cdiv class=\"video-container\"\u003e\n  \u003ciframe\n    width=\"100%\"\n    height=\"500\"\n    src=\"https://www.youtube.com/embed/2J7g3KcZJ3I\"\n    title=\"Building a Simple Shell in C\"\n    frameborder=\"0\"\n    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n    allowfullscreen\u003e\n  \u003c/iframe\u003e\n\u003c/div\u003e\n\u003ch3\u003e1. The Shell Process Lifecycle\u003c/h3\u003e\n\u003cp\u003eThe shell can be broken down into three distinct phases:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRead Phase\u003c/strong\u003e: The shell reads the user’s command.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eParse Phase\u003c/strong\u003e: The shell breaks the command into individual tokens (like command and arguments) and prepares for execution.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExecute Phase\u003c/strong\u003e: The shell forks a new process to execute the command.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet’s explore each phase in more detail.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003e2. \u003cstrong\u003eRead Phase\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eIn the \u003cstrong\u003eRead Phase\u003c/strong\u003e, the shell waits for user input. This input could be a simple command like \u003ccode\u003els\u003c/code\u003e or something more complex, involving pipes (\u003ccode\u003e|\u003c/code\u003e) and redirection (\u003ccode\u003e\u0026gt;\u003c/code\u003e, \u003ccode\u003e\u0026lt;\u003c/code\u003e). The input is typically read as a single string, which the shell will process further.\u003c/p\u003e\n\u003cp\u003eIn C, this can be achieved using functions like \u003ccode\u003efgets()\u003c/code\u003e or \u003ccode\u003eread()\u003c/code\u003e to capture input from the user.\u003c/p\u003e\n\u003ch4\u003eExample:\u003c/h4\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e input[\u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e];\n\n\u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;shell\u0026gt; \u0026quot;\u003c/span\u003e);\n\nfgets(input, \u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(input), \u003cspan class=\"hljs-built_in\"\u003estdin\u003c/span\u003e);\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis code snippet captures user input of up to 1024 characters. Once the input is read, the shell proceeds to the \u003cstrong\u003eParse Phase\u003c/strong\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003e3. \u003cstrong\u003eParse Phase\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eThe \u003cstrong\u003eParse Phase\u003c/strong\u003e involves breaking down the user’s input into smaller components, known as \u003cstrong\u003etokens\u003c/strong\u003e. These tokens are typically the command (like \u003ccode\u003els\u003c/code\u003e) and its arguments (like \u003ccode\u003e-l\u003c/code\u003e, \u003ccode\u003e| grep .c\u003c/code\u003e).\u003c/p\u003e\n\u003cp\u003eIn C, functions like \u003ccode\u003estrtok()\u003c/code\u003e are useful for breaking the input string into tokens based on delimiters (like spaces or pipe symbols).\u003c/p\u003e\n\u003ch4\u003eExample:\u003c/h4\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode\u003e\n\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e *token;\n\ntoken = strtok(input, \u003cspan class=\"hljs-string\"\u003e\u0026quot; \\n\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (token != \u003cspan class=\"hljs-literal\"\u003eNULL\u003c/span\u003e) {\n\n    \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;%s\\n\u0026quot;\u003c/span\u003e, token);  \u003cspan class=\"hljs-comment\"\u003e// Process each token\u003c/span\u003e\n\n    token = strtok(\u003cspan class=\"hljs-literal\"\u003eNULL\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot; \\n\u0026quot;\u003c/span\u003e);\n\n}\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will break the user’s input into individual tokens. For example, if the user types \u003ccode\u003els -l | grep .c\u003c/code\u003e, the tokens will be \u003ccode\u003els\u003c/code\u003e, \u003ccode\u003e-l\u003c/code\u003e, \u003ccode\u003e|\u003c/code\u003e, and \u003ccode\u003egrep .c\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe shell needs to handle each of these tokens appropriately, determining what the user wants to achieve (e.g., if there’s a pipe, we need to split the command into two processes).\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003e4. \u003cstrong\u003eExecute Phase\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eFinally, the \u003cstrong\u003eExecute Phase\u003c/strong\u003e is where the shell runs the command. In most cases, this involves creating a new child process using \u003ccode\u003efork()\u003c/code\u003e, and then using \u003ccode\u003eexecvp()\u003c/code\u003e or similar system calls to replace the child process’s memory with the new command’s memory.\u003c/p\u003e\n\u003cp\u003eFor commands involving pipes or redirection, this phase becomes slightly more complex, as the shell needs to manage file descriptors and direct output from one process to another.\u003c/p\u003e\n\u003ch4\u003eExample:\u003c/h4\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode\u003e\n\u003cspan class=\"hljs-type\"\u003epid_t\u003c/span\u003e pid = fork();\n\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pid == \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Child process\u003c/span\u003e\n\n    execvp(command[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e], command);\n\n    perror(\u003cspan class=\"hljs-string\"\u003e\u0026quot;execvp\u0026quot;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(EXIT_FAILURE);\n\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pid \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n\n    \u003cspan class=\"hljs-comment\"\u003e// Parent process\u003c/span\u003e\n\n    wait(\u003cspan class=\"hljs-literal\"\u003eNULL\u003c/span\u003e);\n\n} \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\n    perror(\u003cspan class=\"hljs-string\"\u003e\u0026quot;fork\u0026quot;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-built_in\"\u003eexit\u003c/span\u003e(EXIT_FAILURE);\n\n}\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis simple fork/exec pattern allows the shell to run commands. The parent process waits for the child to complete using \u003ccode\u003ewait()\u003c/code\u003e, ensuring that commands are executed sequentially unless the user requests background execution.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003e5. \u003cstrong\u003eAdvanced Features\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eBuilding a fully functional shell also requires adding advanced features like:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003ePiping\u003c/strong\u003e: Sending the output of one command as input to another (e.g., \u003ccode\u003els | grep .c\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRedirection\u003c/strong\u003e: Redirecting output to a file or input from a file (e.g., \u003ccode\u003els \u0026gt; output.txt\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eSignal Handling\u003c/strong\u003e: Handling interrupts (e.g., \u003ccode\u003eCtrl+C\u003c/code\u003e) to terminate running processes or commands.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhile these features add complexity, they are also what make a shell useful. Understanding the basics of process control and inter-process communication (pipes) will help you implement these features.\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003eConclusion\u003c/h3\u003e\n\u003cp\u003eBuilding a shell from scratch is an excellent way to learn about process management, system calls, and low-level programming in C. By breaking the problem down into the \u003cstrong\u003eRead\u003c/strong\u003e, \u003cstrong\u003eParse\u003c/strong\u003e, and \u003cstrong\u003eExecute\u003c/strong\u003e phases, you can focus on each aspect individually and build up to more complex features like piping and redirection.\u003c/p\u003e\n\u003cp\u003eOnce you understand how these phases interact, you can experiment with adding more functionality and customization to your shell. And who knows? You might end up building a command-line interface that fits your workflow better than existing ones.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eGitHub: \u003ca href=\"https://github.com/Atharva2099\"\u003e@FullMLAlchemist\u003c/a\u003e\nTwitter: \u003ca href=\"https://x.com/attharave\"\u003e@Attharave\u003c/a\u003e\u003c/p\u003e\n","title":"Building a Shell in C","date":"2024-10-28","categories":["Programming","C","Operating Systems"],"image":"/images/building-a-shell-in-c.png","summary":""}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"Building a Simple Shell in C"},"buildId":"NyHoP_d_kbc-0VeRRnbDN","assetPrefix":"/280CharsArentEnough","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>